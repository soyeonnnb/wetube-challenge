(()=>{const e=document.getElementById("commentForm"),t=document.getElementById("videoContainer"),n=document.querySelector("#commentContainer ul"),a=n.querySelectorAll(".comment__delete"),o=n.querySelectorAll(".comment__edit"),c=document.querySelectorAll(".comment__edit-btn"),r=async e=>{e.preventDefault();const t=e.target.parentElement.parentElement.parentElement,n=t.dataset.id;200===(await fetch(`/api/comments/${n}/delete`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).status&&t.remove()},m=async e=>{e.preventDefault();const t=e.target.parentElement,n=t.querySelector(".commentEditFormInput").value,a=t.dataset.id;200===(await fetch(`/api/comments/${a}/edit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n})})).status&&(t.querySelector(".comment-text").innerText=n)},i=e=>{e.preventDefault();const t=e.target.parentElement.parentElement.parentElement.parentElement.querySelector(".comment__edit");t.classList.contains("hidden")?t.classList.remove("hidden"):t.classList.add("hidden")};e&&e.addEventListener("submit",(async a=>{a.preventDefault();const o=e.querySelector(".commentFormInput").value,c=t.dataset.id;if(""===o)return;const r=await fetch(`/api/videos/${c}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:o})});if(201===r.status){const{newCommentId:e}=await r.json();((e,t)=>{const a=n.querySelector(".comment-none");a&&a.remove();const o=document.createElement("li");o.dataset.id=t;const c=document.createElement("span");c.innerText=e,o.appendChild(c),n.prepend(o)})(o,e)}textarea.value=""})),a&&[].forEach.call(a,(function(e){e.addEventListener("click",r)})),o&&[].forEach.call(o,(function(e){e.addEventListener("submit",m)})),c&&[].forEach.call(c,(function(e){e.addEventListener("click",i)}))})();